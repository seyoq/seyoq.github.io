
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‘˜ë§Œì˜ ì±—</title>
  <style>
    body { font-family: sans-serif; background: #1c1c1c; color: #fff; padding: 20px; }
    textarea, input { width: 100%; margin: 5px 0; padding: 8px; border-radius: 5px; border: none; }
    textarea { height: 100px; }
    button { padding: 10px; margin-top: 5px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
    .section { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 10px; }
    .highlight { background: #333; padding: 5px; border-radius: 5px; margin-top: 5px; }
    .log { background: #000; padding: 10px; border-radius: 5px; font-family: monospace; height: 100px; overflow-y: auto; font-size: 0.9em; }
  </style>
</head>
<body>

<h1>ğŸ§© ë‘˜ë§Œì˜ ë¹„ë°€ì±—</h1>

<div class="section">
  <h2>1ï¸âƒ£ 1ë²ˆ ì¹œêµ¬: ì—°ê²° ì½”ë“œ ìƒì„±</h2>
  <button onclick="createOffer()">ğŸ¯ ì—°ê²° ì½”ë“œ ë§Œë“¤ê¸°</button>
  <textarea id="offerOutput" placeholder="ìƒì„±ëœ Offer í‘œì‹œ" readonly></textarea>
  <button onclick="copyText('offerOutput')">ğŸ“‹ ë³µì‚¬</button>
</div>

<div class="section">
  <h2>2ï¸âƒ£ 2ë²ˆ ì¹œêµ¬: ìƒëŒ€ Offer ë¶™ì—¬ë„£ê³  ì‘ë‹µ ìƒì„±</h2>
  <textarea id="offerInput" placeholder="ì—¬ê¸°ì— 1ë²ˆ ì¹œêµ¬ì˜ Offer ë¶™ì—¬ë„£ê¸°"></textarea>
  <button onclick="createAnswer()">âš™ï¸ ì‘ë‹µ ìƒì„±</button>
  <textarea id="answerOutput" placeholder="ìƒì„±ëœ Answer í‘œì‹œ" readonly></textarea>
  <button onclick="copyText('answerOutput')">ğŸ“‹ ë³µì‚¬</button>
</div>

<div class="section">
  <h2>3ï¸âƒ£ 1ë²ˆ ì¹œêµ¬: ìƒëŒ€ë°© ì‘ë‹µ ë¶™ì—¬ë„£ê¸°</h2>
  <textarea id="answerInput" placeholder="ì—¬ê¸°ì— Answer ë¶™ì—¬ë„£ê¸°"></textarea>
  <button onclick="applyAnswer()">âœ… ì—°ê²° ì™„ë£Œí•˜ê¸°</button>
</div>

<div class="section">
  <h2>ğŸ’¬ ë©”ì‹œì§€ ì£¼ê³ ë°›ê¸°</h2>
  <input id="messageInput" placeholder="ë©”ì‹œì§€ ì…ë ¥" />
  <button onclick="sendMessage()">ğŸ“¨ ì „ì†¡</button>
  <div class="log" id="log">ğŸ“ ë¡œê·¸ ì¶œë ¥</div>
</div>

<script>
let pc, channel;

const servers = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };

function log(message) {
  const el = document.createElement("div");
  el.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
  document.getElementById("log").appendChild(el);
  document.getElementById("log").scrollTop = document.getElementById("log").scrollHeight;
}

function copyText(id) {
  navigator.clipboard.writeText(document.getElementById(id).value);
  log("ğŸ“‹ ë³µì‚¬ë¨: " + id);
}

function setupPC(isOfferer) {
  pc = new RTCPeerConnection(servers);

  if (isOfferer) {
    channel = pc.createDataChannel("chat");
    channel.onopen = () => log("âœ… ì±„ë„ ì—´ë¦¼");
    channel.onmessage = e => log("ğŸ“© ë°›ì€ ë©”ì‹œì§€: " + e.data);
  } else {
    pc.ondatachannel = (e) => {
      channel = e.channel;
      channel.onopen = () => log("âœ… ì±„ë„ ì—´ë¦¼");
      channel.onmessage = e => log("ğŸ“© ë°›ì€ ë©”ì‹œì§€: " + e.data);
    };
  }

  pc.onicecandidate = () => {
    if (pc.iceGatheringState === "complete") {
      const desc = JSON.stringify(pc.localDescription);
      if (isOfferer) document.getElementById("offerOutput").value = desc;
      else document.getElementById("answerOutput").value = desc;
    }
  };
}

async function createOffer() {
  setupPC(true);
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  log("ğŸ› ï¸ Offer ìƒì„±");
}

async function createAnswer() {
  setupPC(false);
  const offer = JSON.parse(document.getElementById("offerInput").value);
  await pc.setRemoteDescription(offer);
  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);
  log("ğŸ› ï¸ Answer ìƒì„±");
}

async function applyAnswer() {
  const answer = JSON.parse(document.getElementById("answerInput").value);
  await pc.setRemoteDescription(answer);
  log("ğŸ”— ì—°ê²° ì™„ë£Œ!");
}

function sendMessage() {
  const msg = document.getElementById("messageInput").value;
  if (channel?.readyState === "open") {
    channel.send(msg);
    log("ğŸ“¤ ì „ì†¡: " + msg);
  } else {
    log("âŒ ì±„ë„ì´ ì—´ë ¤ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }
}
</script>
</body>
</html>
